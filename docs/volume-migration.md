# Перенос данных docker volume в локальные каталоги

Скрипт `docker/migrate-volumes.sh` переносит содержимое существующих docker volume в каталоги внутри репозитория и перенастраивает сами volume так, чтобы они ссылались на эти каталоги. По умолчанию файлы будут помещены в `docker/volumes/` рядом с `docker-compose.yml`.

## Использование

```bash
cd docker
./migrate-volumes.sh           # перенос в docker/volumes/
./migrate-volumes.sh /path/... # произвольный каталог назначения
```

Скрипт проверяет наличие следующих volume и, если они существуют, копирует их содержимое и переопределяет их на bind-монты:

- `jenkins_home`
- `minio_data`
- `postgres_data`
- `registry_data`
- `mlflow_data`

Для копирования используется временный контейнер `alpine:3.19`, поэтому образ будет автоматически скачан при первом запуске (при необходимости).

> Примечание: сервис MLflow хранит состояние в Postgres и MinIO, поэтому исходный стек мог не создавать volume `mlflow_data`. Скрипт обработает это и создаст новый bind-монт, благодаря чему данные MLflow будут храниться в каталоге `docker/volumes/mlflow/`.

## После переноса

1. Перед запуском убедитесь, что контейнеры остановлены (`docker compose down`), иначе удаление старых volume завершится ошибкой.
2. Убедитесь, что каталоги с данными появились в целевой директории (по умолчанию `docker/volumes/*`).
3. Запустите сервисы повторно: `docker compose up -d --build`.
4. Проверьте, что Jenkins, MLflow и другие сервисы видят прежние данные.

> После выполнения скрипта именованные volume (`jenkins_home`, `minio_data` и т.д.) будут указывать на каталоги внутри `docker/volumes/`, поэтому дополнительная настройка `docker-compose.yml` не требуется.

Каталоги с данными добавлены в `.gitignore`, поэтому они не будут попадать в репозиторий, но останутся под контролем в файловой системе WSL.
